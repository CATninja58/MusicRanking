<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Album Tier List</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #searchSection { margin-bottom: 20px; }
    input { padding: 8px; width: 300px; }
    button { padding: 8px; }
    .tier-row {
      display: flex;
      align-items: center;
      margin: 10px 0;
      border: 2px solid #ccc;
      min-height: 120px;
      padding: 10px;
    }
    .tier-label {
      width: 50px;
      font-weight: bold;
      margin-right: 10px;
    }
    .album {
      margin: 5px;
      cursor: grab;
    }
    .album img {
      height: 100px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div id="searchSection">
    <input type="text" id="artistInput" placeholder="Search for an artist...">
    <button onclick="searchArtist()">Search</button>
  </div>

  <div id="albumList" style="display: flex; flex-wrap: wrap; margin-bottom: 40px;"></div>

  <div id="tierList">
    <div class="tier-row" data-tier="S">
      <div class="tier-label">S</div>
    </div>
    <div class="tier-row" data-tier="A">
      <div class="tier-label">A</div>
    </div>
    <div class="tier-row" data-tier="B">
      <div class="tier-label">B</div>
    </div>
    <div class="tier-row" data-tier="C">
      <div class="tier-label">C</div>
    </div>
    <div class="tier-row" data-tier="D">
      <div class="tier-label">D</div>
    </div>
  </div>

  <button onclick="saveTierList()">ðŸ’¾ Save Tier List</button>

  <script>
    let currentAlbums = [];

    async function searchArtist() {
      const artistName = document.getElementById('artistInput').value;
      const url = `https://itunes.apple.com/search?term=${encodeURIComponent(artistName)}&entity=album&limit=200`;
      const response = await fetch(url);
      const data = await response.json();
      
      const albums = deduplicateAlbums(data.results);
      currentAlbums = albums;
      renderAlbums(albums);
    }

    function deduplicateAlbums(results) {
      const seen = new Set();
      return results.filter(album => {
        if (seen.has(album.collectionName)) return false;
        seen.add(album.collectionName);
        return true;
      }).sort((a, b) => new Date(a.releaseDate) - new Date(b.releaseDate));
    }

    function renderAlbums(albums) {
      const container = document.getElementById('albumList');
      container.innerHTML = '';
      albums.forEach(album => {
        const div = document.createElement('div');
        div.className = 'album';
        div.draggable = true;
        div.dataset.id = album.collectionId;
        div.innerHTML = `<img src="${album.artworkUrl100}" title="${album.collectionName}">`;
        div.addEventListener('dragstart', e => {
          e.dataTransfer.setData('text/plain', album.collectionId);
        });
        container.appendChild(div);
      });
    }

    document.querySelectorAll('.tier-row').forEach(row => {
      row.addEventListener('dragover', e => e.preventDefault());
      row.addEventListener('drop', e => {
        e.preventDefault();
        const albumId = e.dataTransfer.getData('text/plain');
        const album = currentAlbums.find(a => a.collectionId == albumId);
        if (album) {
          const existing = row.querySelector(`[data-id='${albumId}']`);
          if (existing) return;
          const div = document.createElement('div');
          div.className = 'album';
          div.dataset.id = album.collectionId;
          div.innerHTML = `<img src="${album.artworkUrl100}" title="${album.collectionName}">`;
          div.draggable = true;
          div.addEventListener('dragstart', e => {
            e.dataTransfer.setData('text/plain', album.collectionId);
          });
          row.appendChild(div);
        }
      });
    });

    function saveTierList() {
      const result = {};
      document.querySelectorAll('.tier-row').forEach(row => {
        const tier = row.dataset.tier;
        result[tier] = [];
        row.querySelectorAll('.album').forEach(albumDiv => {
          const albumId = albumDiv.dataset.id;
          const album = currentAlbums.find(a => a.collectionId == albumId);
          if (album) result[tier].push(album.collectionName);
        });
      });
      localStorage.setItem('tierList', JSON.stringify(result));
      alert('Tier list saved!');
    }
  </script>
</body>
</html>
