<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tier List Ranking</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    h1, h2 {
      text-align: center;
    }

    .tier {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .tier-label {
      width: 50px;
      font-weight: bold;
    }

    .tier-items {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      min-height: 80px;
      border: 1px solid #ccc;
      padding: 10px;
      flex: 1;
    }

    .unranked-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 10px;
      margin-top: 20px;
      border-top: 2px dashed #888;
      padding-top: 10px;
    }

    .item {
      width: 80px;
      height: 80px;
      position: relative;
      cursor: grab;
    }

    .item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .item .tooltip {
      position: absolute;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      width: 100%;
      text-align: center;
      font-size: 12px;
      padding: 2px;
      display: none;
    }

    .item:hover .tooltip {
      display: block;
    }

    .album-selection {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .album-select {
      width: 100px;
      height: 100px;
      position: relative;
      cursor: pointer;
    }

    .album-select img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .album-select .tooltip {
      position: absolute;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      width: 100%;
      text-align: center;
      font-size: 12px;
      padding: 2px;
      display: none;
    }

    .album-select:hover .tooltip {
      display: block;
    }

    .search-bar {
      margin-top: 10px;
      text-align: center;
    }

    .search-bar input {
      padding: 6px;
      width: 60%;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h1>My Tier List</h1>

  <div class="album-selection" id="albumSelection"></div>
  <div class="search-bar">
    <input type="text" id="songSearch" placeholder="Search for a song..." />
  </div>

  <div id="tierList">
    <div class="tier" data-tier="S">
      <div class="tier-label">S</div>
      <div class="tier-items" id="tier-S"></div>
    </div>
    <div class="tier" data-tier="A">
      <div class="tier-label">A</div>
      <div class="tier-items" id="tier-A"></div>
    </div>
    <div class="tier" data-tier="B">
      <div class="tier-label">B</div>
      <div class="tier-items" id="tier-B"></div>
    </div>
    <div class="tier" data-tier="C">
      <div class="tier-label">C</div>
      <div class="tier-items" id="tier-C"></div>
    </div>
    <div class="tier" data-tier="D">
      <div class="tier-label">D</div>
      <div class="tier-items" id="tier-D"></div>
    </div>
  </div>

  <h2>Unranked Items</h2>
  <div class="unranked-container" id="unrankedContainer"></div>

  <script>
    const tierIds = ['S', 'A', 'B', 'C', 'D'];
    let data = [
      {
        name: 'Album 1',
        cover: 'album1.jpg',
        songs: [
          { name: 'Song 1', cover: 'album1.jpg' },
          { name: 'Song 2', cover: 'album1.jpg' }
        ]
      },
      {
        name: 'Album 2',
        cover: 'album2.jpg',
        songs: [
          { name: 'Song A', cover: 'album2.jpg' },
          { name: 'Song B', cover: 'album2.jpg' }
        ]
      }
    ];

    const albumSelection = document.getElementById('albumSelection');
    const unrankedContainer = document.getElementById('unrankedContainer');
    const songSearch = document.getElementById('songSearch');

    function createItemElement(name, cover) {
      const div = document.createElement('div');
      div.className = 'item';
      div.setAttribute('draggable', 'true');
      div.setAttribute('data-name', name);
      div.setAttribute('data-cover', cover);

      const img = document.createElement('img');
      img.src = cover;
      img.alt = name;
      div.appendChild(img);

      const tooltip = document.createElement('div');
      tooltip.className = 'tooltip';
      tooltip.textContent = name;
      div.appendChild(tooltip);

      addDragEvents(div);
      return div;
    }

    function addDragEvents(element) {
      element.addEventListener('dragstart', dragStart);
      element.addEventListener('dragend', dragEnd);
    }

    function dragStart(e) {
      e.dataTransfer.setData('text/plain', e.target.dataset.name);
      e.dataTransfer.setData('text/cover', e.target.dataset.cover);
      e.dataTransfer.setData('text/html', e.target.outerHTML);
      e.target.classList.add('dragging');
    }

    function dragEnd(e) {
      e.target.classList.remove('dragging');
    }

    function allowDrop(e) {
      e.preventDefault();
    }

    function drop(e) {
      e.preventDefault();
      const name = e.dataTransfer.getData('text/plain');
      const cover = e.dataTransfer.getData('text/cover');
      const newItem = createItemElement(name, cover);
      e.currentTarget.appendChild(newItem);
      saveState();
    }

    function saveState() {
      const state = {};
      tierIds.forEach(tier => {
        const tierElement = document.getElementById('tier-' + tier);
        const items = [...tierElement.querySelectorAll('.item')].map(el => ({
          name: el.dataset.name,
          cover: el.dataset.cover
        }));
        state[tier] = items;
      });
      const unrankedItems = [...unrankedContainer.querySelectorAll('.item')].map(el => ({
        name: el.dataset.name,
        cover: el.dataset.cover
      }));
      state['unranked'] = unrankedItems;
      localStorage.setItem('tierListState', JSON.stringify(state));
    }

    function loadState() {
      const savedState = JSON.parse(localStorage.getItem('tierListState'));
      if (savedState) {
        tierIds.forEach(tier => {
          const tierElement = document.getElementById('tier-' + tier);
          tierElement.innerHTML = '';
          if (savedState[tier]) {
            savedState[tier].forEach(item => {
              const newItem = createItemElement(item.name, item.cover);
              tierElement.appendChild(newItem);
            });
          }
        });
        unrankedContainer.innerHTML = '';
        if (savedState['unranked']) {
          savedState['unranked'].forEach(item => {
            const newItem = createItemElement(item.name, item.cover);
            unrankedContainer.appendChild(newItem);
          });
        }
      }
    }

    function renderAlbumSelection() {
      albumSelection.innerHTML = '';
      data.forEach(album => {
        const div = document.createElement('div');
        div.className = 'album-select';
        div.setAttribute('data-name', album.name);

        const img = document.createElement('img');
        img.src = album.cover;
        img.alt = album.name;
        div.appendChild(img);

        const tooltip = document.createElement('div');
        tooltip.className = 'tooltip';
        tooltip.textContent = album.name;
        div.appendChild(tooltip);

        div.addEventListener('click', () => {
          renderSongs(album.songs);
        });
        albumSelection.appendChild(div);
      });
    }

    function renderSongs(songs) {
      unrankedContainer.innerHTML = '';
      songs.forEach(song => {
        const item = createItemElement(song.name, song.cover);
        unrankedContainer.appendChild(item);
      });
    }

    function renderAllSongs() {
      const allSongs = data.flatMap(album =>
        album.songs.map(song => ({
          name: song.name,
          cover: album.cover
        }))
      );
      renderSongs(allSongs);
    }

    songSearch.addEventListener('input', () => {
      const query = songSearch.value.toLowerCase();
      const items = unrankedContainer.querySelectorAll('.item');
      items.forEach(item => {
        const name = item.dataset.name.toLowerCase();
        item.style.display = name.includes(query) ? '' : 'none';
      });
    });

    tierIds.forEach(tier => {
      const tierElement = document.getElementById('tier-' + tier);
      tierElement.addEventListener('dragover', allowDrop);
      tierElement.addEventListener('drop', drop);
    });

    unrankedContainer.addEventListener('dragover', allowDrop);
    unrankedContainer.addEventListener('drop', drop);

    // Initialize
    renderAlbumSelection();
    renderAllSongs();
    loadState();
  </script>
</body>
</html>
